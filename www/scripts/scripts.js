angular.module("fsCordova",[]).service("CordovaService",["$document","$q",function(a,b){var c=b.defer(),d=!1;this.ready=c.promise,document.addEventListener("deviceready",function(){d=!0,c.resolve(window.cordova)}),setTimeout(function(){d||window.cordova&&c.resolve(window.cordova)},3e3)}]),angular.module("yoApp",["ngCookies","ngResource","ngSanitize","ngRoute","fsCordova","ngStorage"]).config(["$routeProvider","$sceDelegateProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$localStorage","$sessionStorage",function(a,b,c){a.$storage=c,a.url="http://jarvis-dev.niwsc.com/deviceapi-2.0/rest"}]),angular.module("yoApp").controller("MainCtrl",["$rootScope","$scope","$http","$localStorage","$sessionStorage","$interval","CordovaService",function(a,b,c,d,e,f,g){function h(){var a=[],c="",d=(new Date).getTime();b.accX=Math.random(),b.accY=Math.random(),b.accZ=Math.random(),b.accTimestamp=d,r.push(b.accX),s.push(b.accX),t.push(b.accX),u.push(o*q),o+=1,o>p&&(b.$storage.channels.forEach(function(b){c=b.deviceId,"Accelerometer X"===b.channelName?(console.log("channel ID: "+b.id),a.push({t0:d,channelId:b.id,dt:u,values:r})):"Accelerometer Y"===b.channelName?(console.log("channel ID: "+b.id),a.push({t0:d,channelId:b.id,dt:u,values:s})):"Accelerometer Z"===b.channelName&&(console.log("channel ID: "+b.id),a.push({t0:d,channelId:b.id,dt:u,values:t}))}),console.log("Write Channel Data"),l(c,a),r=[],s=[],t=[],u=[],o=0)}function i(a){var c=[],d="",e=(new Date).getTime();b.accX=a.x,b.accY=a.y,b.accZ=a.z,b.accTimestamp=a.timestamp,b.$apply(),r.push(a.x),s.push(a.y),t.push(a.z),u.push(o*q),o+=1,o>p&&(b.$storage.channels.forEach(function(a){d=a.deviceId,"Accelerometer X"===a.channelName?(console.log("channel ID: "+a.id),c.push({t0:e,channelId:a.id,dt:u,values:r})):"Accelerometer Y"===a.channelName?(console.log("channel ID: "+a.id),c.push({t0:e,channelId:a.id,dt:u,values:s})):"Accelerometer Z"===a.channelName&&(console.log("channel ID: "+a.id),c.push({t0:e,channelId:a.id,dt:u,values:t}))}),console.log("Write Channel Data"),l(d,c),r=[],s=[],t=[],u=[],o=0)}function j(){alert("onError!")}function k(d,e,f){var g=!1;if(b.$storage.channels.forEach(function(a){a.channelName===e&&(g=!0)}),g===!1){var h=a.url+"/devices/"+d+"/channels/",i=(new Date).getTime();c({url:h,method:"POST",timeout:1e4,data:{deviceId:d,userDefinedChannelId:f,t0:i,channelType:"AI",channelName:e},headers:{"Content-Type":"application/json","x-ni-apikey":"MGCTApKKBaInxrBIsSGYeHAWALYcnnLM"}}).success(function(a){console.log("add channel"),b.$storage.channels.push(a),console.log(b.$storage)}).error(function(){console.log("error creating channel "+e)})}}function l(b,d){var e=a.url+"/devices/"+b+"/channels/";c({url:e,method:"PUT",timeout:1e4,data:d,headers:{"Content-Type":"application/json","x-ni-apikey":"MGCTApKKBaInxrBIsSGYeHAWALYcnnLM"}}).success(function(a){console.log(a)}).error(function(){console.log("error posting channel data")})}var m,n=!0,o=0,p=40,q=50,r=[],s=[],t=[],u=[];b.$storage=d,b.$storage.channels=[],b.accX=0,b.accY=0,b.accZ=0,b.accTimestamp=0,console.log("Start main"),g.ready.then(function(){console.log("Cordova Ready"),n=!1}),b.start=function(){angular.isDefined(m)||(m=n===!0?f(function(){h()},q):f(function(){navigator.accelerometer.getCurrentAcceleration(i,j)},q))},b.pause=function(){angular.isDefined(m)&&(f.cancel(m),m=void 0)},b.openWebsite=function(a){window.open(a,"_system")},b.createDevice=function(d){var e=a.url+"/devices/register";c({url:e,method:"POST",timeout:1e4,data:{deviceType:"MobilePhone",deviceName:d,serialNumber:d},headers:{"Content-Type":"application/json","x-ni-apikey":"MGCTApKKBaInxrBIsSGYeHAWALYcnnLM"}}).success(function(a){console.log(a),b.device=a,k(d,"Accelerometer X",0),k(d,"Accelerometer Y",1),k(d,"Accelerometer Z",2)}).error(function(a){console.log("error registering phone")})}}]),angular.module("yoApp").service("Cordova",["$document","$q",function(a,b){var c=b.defer(),d=!1;this.ready=c.promise,document.addEventListener("deviceready",function(){d=!0,c.resolve(window.cordova)}),setTimeout(function(){d||window.cordova&&c.resolve(window.cordova)},3e3)}]);