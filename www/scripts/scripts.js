angular.module("fsCordova",[]).service("CordovaService",["$document","$q",function(a,b){var c=b.defer(),d=!1;this.ready=c.promise,document.addEventListener("deviceready",function(){d=!0,c.resolve(window.cordova)}),setTimeout(function(){d||window.cordova&&c.resolve(window.cordova)},3e3)}]),angular.module("yoApp",["ngCookies","ngResource","ngSanitize","ngRoute","fsCordova","ngStorage"]).config(["$routeProvider","$sceDelegateProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$localStorage","$sessionStorage",function(a,b,c){a.$storage=c,a.url="http://jarvis-dev.niwsc.com/deviceapi-2.0/rest"}]),angular.module("yoApp").controller("MainCtrl",["$rootScope","$scope","$http","$localStorage","$sessionStorage","$interval","CordovaService",function(a,b,c,d,e,f,g){function h(a){var c=[];console.log(a),b.accX=a.x,b.accY=a.y,b.accZ=a.z,b.accTimestamp=a.timestamp,b.$apply(),b.$storage.channels.forEach(function(d){"Accelerometer X"===d.channelName?c.push({t0:a.timestamp,channelId:d.channelId,dt:[0],values:[a.x]}):"Accelerometer Y"===d.channelName?c.push({t0:a.timestamp,channelId:d.channelId,dt:[0],values:[a.y]}):"Accelerometer Z"===d.channelName&&c.push({t0:a.timestamp,channelId:d.channelId,dt:[0],values:[a.z]}),k(b.$storage.device.deviceId,c)})}function i(){alert("onError!")}function j(d,e,f){var g=!1;if(b.$storage.channels.forEach(function(a){a.channelName===e&&(g=!0)}),g===!1){var h=a.url+"/devices/"+d+"/channels/",i=(new Date).getTime();c({url:h,method:"POST",timeout:1e4,data:{deviceId:d,userDefinedChannelId:f,t0:i,channelType:"AI",channelName:e},headers:{"Content-Type":"application/json","x-ni-apikey":"MGCTApKKBaInxrBIsSGYeHAWALYcnnLM"}}).success(function(a){console.log(a),b.$storage.channels.push(a)}).error(function(){console.log("error creating channel "+e)})}}function k(b,d){var e=a.url+"/devices/"+b+"/channels/";c({url:e,method:"PUT",timeout:1e4,data:d,headers:{"Content-Type":"application/json","x-ni-apikey":"MGCTApKKBaInxrBIsSGYeHAWALYcnnLM"}}).success(function(a){console.log(a)}).error(function(){console.log("error posting channel data")})}b.$storage=d,b.$storage.channels=[],b.accX=0,b.accY=0,b.accZ=0,b.accTimestamp=0,console.log("Start main"),g.ready.then(function(){console.log("Cordova Ready");f(function(){navigator.accelerometer.getCurrentAcceleration(h,i)},2e3)}),b.openWebsite=function(a){window.open(a,"_system")},b.createDevice=function(d){var e=a.url+"/devices/register";c({url:e,method:"POST",timeout:1e4,data:{deviceType:"MobilePhone",deviceName:d,serialNumber:d},headers:{"Content-Type":"application/json","x-ni-apikey":"MGCTApKKBaInxrBIsSGYeHAWALYcnnLM"}}).success(function(a){b.$storage.device=a,j(d,"Accelerometer X")}).error(function(a){"Device already registered."===a&&(b.$storage.device=a,j(d,"Accelerometer X",0),j(d,"Accelerometer Y",1),j(d,"Accelerometer Z",2)),console.log("error registering phone")})}}]),angular.module("yoApp").service("Cordova",["$document","$q",function(a,b){var c=b.defer(),d=!1;this.ready=c.promise,document.addEventListener("deviceready",function(){d=!0,c.resolve(window.cordova)}),setTimeout(function(){d||window.cordova&&c.resolve(window.cordova)},3e3)}]);