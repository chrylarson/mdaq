angular.module("fsCordova",[]).service("CordovaService",["$document","$q",function(a,b){var c=b.defer(),d=!1;this.ready=c.promise,document.addEventListener("deviceready",function(){d=!0,c.resolve(window.cordova)}),setTimeout(function(){d||window.cordova&&c.resolve(window.cordova)},3e3)}]),angular.module("yoApp",["ngCookies","ngResource","ngSanitize","ngRoute","fsCordova","ngStorage"]).config(["$routeProvider","$sceDelegateProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$localStorage","$sessionStorage",function(a,b,c){a.$storage=c,a.url="http://jarvis-dev.niwsc.com/deviceapi-2.0/rest"}]),angular.module("yoApp").controller("MainCtrl",["$rootScope","$scope","$http","$localStorage","$sessionStorage","$interval","CordovaService",function(a,b,c,d,e,f,g){function h(){var a=[],c="",d=(new Date).getTime();b.accX=Math.random(),b.accY=Math.random(),b.accZ=Math.random(),b.accTimestamp=d,t.push(b.accX),u.push(b.accX),v.push(b.accX),w.push(q*s),q+=1,q>r&&(b.$storage.channels.forEach(function(b){c=b.deviceId,"Accelerometer X"===b.channelName?(console.log("channel ID: "+b.id),a.push({t0:d,channelId:b.id,dt:w,values:t})):"Accelerometer Y"===b.channelName?(console.log("channel ID: "+b.id),a.push({t0:d,channelId:b.id,dt:w,values:u})):"Accelerometer Z"===b.channelName&&(console.log("channel ID: "+b.id),a.push({t0:d,channelId:b.id,dt:w,values:v}))}),console.log("Write Channel Data"),n(c,a),t=[],u=[],v=[],w=[],q=0)}function i(a){var c=[],d="",e=(new Date).getTime();b.accX=a.x,b.accY=a.y,b.accZ=a.z,b.accTimestamp=a.timestamp,b.$apply(),t.push(a.x),u.push(a.y),v.push(a.z),w.push(q*s),q+=1,q>r&&(b.$storage.channels.forEach(function(a){d=a.deviceId,"Accelerometer X"===a.channelName?(console.log("channel ID: "+a.id),c.push({t0:e,channelId:a.id,dt:w,values:t})):"Accelerometer Y"===a.channelName?(console.log("channel ID: "+a.id),c.push({t0:e,channelId:a.id,dt:w,values:u})):"Accelerometer Z"===a.channelName&&(console.log("channel ID: "+a.id),c.push({t0:e,channelId:a.id,dt:w,values:v}))}),console.log("Write Channel Data"),n(d,c),t=[],u=[],v=[],w=[],q=0)}function j(){alert("onError!")}function k(d){var e=a.url+"/devices/"+d;c({url:e,method:"GET",timeout:1e4,headers:{"Content-Type":"application/json","x-ni-apikey":"MGCTApKKBaInxrBIsSGYeHAWALYcnnLM"}}).success(function(a){console.log(a),b.device=a,l(d)}).error(function(){console.log("error updating phone")})}function l(d){console.log("getting channels");var e=a.url+"/devices/"+d+"/channels/";c({url:e,method:"GET",timeout:1e4,headers:{"Content-Type":"application/json","x-ni-apikey":"MGCTApKKBaInxrBIsSGYeHAWALYcnnLM"}}).success(function(a){console.log(a),b.$storage.channels=a}).error(function(){console.log("error updating phone")})}function m(d,e,f){var g=!1;if(b.$storage.channels.forEach(function(a){a.channelName===e&&(g=!0)}),g===!1){var h=a.url+"/devices/"+d+"/channels/",i=(new Date).getTime();c({url:h,method:"POST",timeout:1e4,data:{deviceId:d,userDefinedChannelId:f,t0:i,channelType:"AI",channelName:e},headers:{"Content-Type":"application/json","x-ni-apikey":"MGCTApKKBaInxrBIsSGYeHAWALYcnnLM"}}).success(function(a){console.log("add channel"),b.$storage.channels.push(a),console.log(b.$storage)}).error(function(){console.log("error creating channel "+e)})}}function n(b,d){var e=a.url+"/devices/"+b+"/channels/";c({url:e,method:"PUT",timeout:1e4,data:d,headers:{"Content-Type":"application/json","x-ni-apikey":"MGCTApKKBaInxrBIsSGYeHAWALYcnnLM"}}).success(function(a){console.log(a)}).error(function(){console.log("error posting channel data")})}var o,p=!0,q=0,r=40,s=50,t=[],u=[],v=[],w=[];b.$storage=d,b.$storage.channels=[],b.accX=0,b.accY=0,b.accZ=0,b.accTimestamp=0,console.log("Start main"),g.ready.then(function(){console.log("Cordova Ready"),p=!1}),b.start=function(){angular.isDefined(o)||(o=p===!0?f(function(){h()},s):f(function(){navigator.accelerometer.getCurrentAcceleration(i,j)},s))},b.pause=function(){angular.isDefined(o)&&(f.cancel(o),o=void 0)},b.openWebsite=function(a){window.open(a,"_system")},b.createDevice=function(d){var e=a.url+"/devices/register";c({url:e,method:"POST",timeout:1e4,data:{deviceType:"MobilePhone",deviceName:d,serialNumber:d},headers:{"Content-Type":"application/json","x-ni-apikey":"MGCTApKKBaInxrBIsSGYeHAWALYcnnLM"}}).success(function(a){console.log(a),b.device=a,m(d,"Accelerometer X",0),m(d,"Accelerometer Y",1),m(d,"Accelerometer Z",2)}).error(function(){k(d),console.log("error registering phone")})}}]),angular.module("yoApp").service("Cordova",["$document","$q",function(a,b){var c=b.defer(),d=!1;this.ready=c.promise,document.addEventListener("deviceready",function(){d=!0,c.resolve(window.cordova)}),setTimeout(function(){d||window.cordova&&c.resolve(window.cordova)},3e3)}]);